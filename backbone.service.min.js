(function(t){"object"==typeof exports?module.exports=t(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],t):t(_,Backbone)})(function(t,e){"use strict";function s(e){this.options=e||{},this.targets=r(this.options.targets||{}),t(this.targets).each(this.createMethod,this)}function r(e){var s;return t(e).map(function(e,r){return s={name:r,path:e,method:"GET"},t.isArray(e)&&t.extend(s,{path:e[0],method:e[1]}),s})}function o(t){this.context=t||this,this.success=[],this.error=[]}s.prototype.createMethod=function(t){var s,r;this[t.name]=function(n,c){return s=new o(this),c=this.createOptions(s,t,n,c),r=i[t.method.toUpperCase()],e.sync(r,this,c),s}},s.prototype.createOptions=function(e,s,r,o){var i=this;return o||(o={}),{url:t.result(this.options,"url")+s.path,data:r,success:function(t){o.success&&o.success.call(i,t),e.resolve(t)},error:function(t,s,r){o.error&&o.error.apply(i,[r,t]),e.reject(r,t)}}};var i={POST:"create",PUT:"update",DELETE:"delete",GET:"read"};t.extend(s.prototype,e.Events),e.Service=s,o.prototype={constructor:o,then:function(t,e){return t&&(this.resolved?t.apply(this.context,this.resolved):this.success.push(t)),e&&(this.rejected?e.apply(this.context,this.rejected):this.error.push(e)),this},resolve:function(){var t;for(this.resolved=arguments,this.error=[];t=this.success.shift();)t.apply(this.context,this.resolved)},reject:function(){var t;for(this.rejected=arguments,this.success=[];t=this.error.shift();)t.apply(this.context,this.rejected)}}});