!function(a){"object"==typeof exports?module.exports=a(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],a):a(_,Backbone)}(function(a,b){"use strict";function c(c){var e="sync_";this[e]={},this.options=c||{};var f=d(this.options.sync||{});a(f).each(a.partial(this.createMethod,this[e]),this),this.targets=d(this.options.targets||{}),a(this.targets).each(a.partial(this.createMethod,this),this),this.sync=function(c,d,f){var g=this[e][c];return a.isFunction(g)?g.call(this,{},f):b.sync(c,d,f)}}function d(b){var c,d="GET";return a(b).map(function(b,e){return c={name:e,path:b,method:d},a.isObject(b)&&!a.isFunction(b)&&a.extend(c,{path:b.path,method:b.method||d,data:b.data}),c})}function e(a){this.context=a||this,this.success=[],this.error=[]}c.defaultModelMapper=void 0,c.prototype.createMethod=function(d,g){var h,i,j=this;d[g.name]=function(d,k){return h=new e(j),d=a.isFunction(g.data)?g.data(this,d):a.isFunction(c.defaultModelMapper)&&"read"!=f[g.method.toUpperCase()]?a.extend(c.defaultModelMapper(this),d,g.data):a.extend({},d,g.data),k=j.createOptions(h,g,k,this),d&&!a.isEmpty(d)&&(b.emulateJSON||(d=JSON.stringify(d),k.contentType="application/json"),k.data=d),k.type=g.method.toUpperCase(),i=a.find(a.values(f),function(a){return a===g.name})?g.name:f[g.method.toUpperCase()],b.sync(i,this,k),h}},c.prototype.createOptions=function(b,c,d,e){var f=this;d||(d={});var g;return g=a.isFunction(c.path)?c.path(e):c.path,{url:a.result(this.options,"url")+g,success:function(a){d.success&&d.success.call(f,a),b.resolve(a)},error:function(a,c,e){d.error&&d.error.apply(f,[e,a]),b.reject(e,a)}}};var f={POST:"create",PUT:"update",DELETE:"delete",GET:"read"};a.extend(c.prototype,b.Events),b.Service=c,e.prototype={constructor:e,then:function(a,b){return a&&(this.resolved?a.apply(this.context,this.resolved):this.success.push(a)),b&&(this.rejected?b.apply(this.context,this.rejected):this.error.push(b)),this},resolve:function(){var a;for(this.resolved=arguments,this.error=[];a=this.success.shift();)a.apply(this.context,this.resolved)},reject:function(){var a;for(this.rejected=arguments,this.success=[];a=this.error.shift();)a.apply(this.context,this.rejected)}}});